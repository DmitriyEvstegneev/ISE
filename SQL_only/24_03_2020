-----------------------------24.03, ДОМАШНЯЯ РАБОТА-----------------------------

1) Полные сведения о деталях, поставляемых поставщиками из Москвы.

SELECT DISTINCT parts.pn, parts.pname, parts.color, parts.weight, parts.city FROM parts
	JOIN sales ON parts.pn = sales.pn
	JOIN suppliers ON sales.sn = suppliers.sn
	WHERE suppliers.city = 'Москва';

2) Найти все пары названий городов, для которых поставщик из первого города поставляет детали для проекта во втором городе

SELECT DISTINCT suppliers.city, projects.city FROM sales
	JOIN suppliers ON sales.sn = suppliers.sn
	JOIN projects ON sales.jn = projects.jn;

3) Установить номера деталей, поставляемых для любого проекта, разрабатываемого в Лондоне.

SELECT DISTINCT spj.pn FROM spj
	JOIN j ON spj.jn = j.jn
	WHERE city = 'London';

4) (Дейт, No 7.38) Определить номера проектов, для которых среднее количество поставляемых деталей с номером Р1 больше, чем наибольшее количество любых деталей, поставляемых для проекта с номером J1

// parts_1 – находим номера проектов и среднее количество деталей среди всех поставок детали pn = 1 для данного проекта
// parts_2 – определяем наибольшее количество деталей среди всех поставок для проекта jn = 1
// определяем исходные номера проектов

WITH parts_1 AS (SELECT jn, AVG(qty) AS avg_qty FROM spj WHERE pn = 1 GROUP BY jn),
	parts_2 AS (SELECT MAX(qty) AS max_qty FROM spj WHERE jn = 1)
	SELECT jn FROM parts_1, parts_2 WHERE avg_qty > max_qty;

5) Найти номера проектов, для которых поставщиками из Лондона не поставляется ни одна деталь красного цвета.

SELECT jn FROM j
EXCEPT
SELECT DISTINCT spj.jn FROM spj
	JOIN s ON spj.sn = s.sn
	JOIN p ON spj.pn = p.pn
	WHERE (s.city = 'London' AND p.color = 'Red');

------------------------24.03, АУДИТОРИЯ + САМОСТОЯТЕЛЬНАЯ------------------------

2. Найти все существующие сочетания вида "цвет детали-город, из которого поставляются детали". Примечание. Здесь и далее термин "все" используется в значении "все, представленные в настоящий момент в базе данных", а не "все возможные".

SELECT DISTINCT color, city FROM parts;

3. Найти все такие тройки значений "номер поставщика—номер детали—номер проекта", для которых указанные поставщик, деталь и проект находятся в одном городе.

SELECT sales.sn, sales.pn, sales.jn FROM sales
	JOIN suppliers ON sales.sn = suppliers.sn
	JOIN parts ON sales.pn = parts.pn
	JOIN projects ON sales.jn = projects.jn
	WHERE (suppliers.city = parts.city AND parts.city = projects.city);

4. Полные сведения о деталях, поставляемых поставщиками из Москвы.

SELECT DISTINCT parts.pn, parts.pname, parts.color, parts.weight, parts.city FROM parts
	JOIN sales ON parts.pn = sales.pn
	JOIN suppliers ON sales.sn = suppliers.sn
	WHERE suppliers.city = 'Москва';

5. Определить номера деталей, поставляемых поставщиком из Москвы для проекта в Москве.

SELECT DISTINCT sales.pn FROM sales
	JOIN suppliers ON sales.sn = suppliers.sn
	JOIN projects ON sales.jn = projects.jn
	WHERE (projects.city = suppliers.city AND suppliers.city = 'Москва');

6. Найти все пары названий городов, для которых поставщик из первого города поставляет детали для проекта во втором городе.

SELECT DISTINCT suppliers.city, projects.city FROM sales
	JOIN suppliers ON sales.sn = suppliers.sn
	JOIN projects ON sales.jn = projects.jn;

7. Определить номера деталей, поставляемых для проектов поставщиком из того же города, в котором разрабатывается проект.

SELECT DISTINCT sales.pn FROM sales
	JOIN suppliers ON suppliers.sn = sales.sn
	JOIN projects ON projects.jn = sales.jn
	WHERE projects.city = suppliers.city;

8. Найти все номера проектов, детали для которых поставляются по крайней мере одним поставщиком из другого города.

SELECT DISTINCT sales.jn FROM sales
	JOIN suppliers ON sales.sn = suppliers.sn
	JOIN projects ON sales.jn = projects.jn
	WHERE suppliers.city <> projects.city;

